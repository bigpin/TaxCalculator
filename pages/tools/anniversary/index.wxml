<view class="container">
  <!-- 顶部标题栏 -->
  <view class="header">
    <view class="header-left">
      <view class="back-btn" bindtap="goBack">
        <t-icon name="chevron-left" size="48rpx" color="#1a3a47" />
      </view>
      <t-icon name="calendar" size="44rpx" color="#1a5d6a" />
      <text class="header-title">纪念日</text>
    </view>
  </view>

  <!-- Tab切换 -->
  <view class="tab-bar">
    <view 
      class="tab-item {{currentTab === 'upcoming' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="upcoming"
    >
      <text>即将到来</text>
    </view>
    <view 
      class="tab-item {{currentTab === 'past' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="past"
    >
      <text>已过去</text>
    </view>
    <view 
      class="tab-item {{currentTab === 'all' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="all"
    >
      <text>全部</text>
    </view>
  </view>

  <!-- 空状态 -->
  <view wx:if="{{displayList.length === 0}}" class="empty-state">
    <view class="empty-icon">
      <t-icon name="calendar" size="100rpx" color="#b8c9d0" />
    </view>
    <text class="empty-text">还没有纪念日</text>
    <text class="empty-desc">点击右下角按钮添加第一个纪念日</text>
  </view>

  <!-- 纪念日列表 -->
  <scroll-view 
    wx:else 
    class="anniversary-list" 
    scroll-y
    enhanced
    show-scrollbar="{{false}}"
  >
    <view 
      wx:for="{{displayList}}" 
      wx:key="id"
      class="anniversary-card"
      bindtap="onCardTap"
      data-item="{{item}}"
    >
      <!-- 左侧图标 -->
      <view class="card-icon {{item.type}}">
        <t-icon name="{{item.iconName}}" size="44rpx" color="{{item.iconColor}}" />
      </view>
      
      <!-- 中间内容 -->
      <view class="card-content">
        <view class="card-title">{{item.name}}</view>
        <view class="card-date">{{item.displayDate}}</view>
        
        <!-- 进度条（仅对年度事件显示） -->
        <view wx:if="{{item.showProgress}}" class="progress-bar">
          <view class="progress-fill" style="width: {{item.progressPercent}}%"></view>
        </view>
      </view>
      
      <!-- 右侧信息 -->
      <view class="card-right">
        <view class="days-badge {{item.badgeType}}">
          <text wx:if="{{item.isToday}}">今天</text>
          <text wx:elif="{{item.isPast}}">{{item.days}}天前</text>
          <text wx:else>{{item.days}}天后</text>
        </view>
        <view class="card-type">{{item.typeName}}</view>
      </view>
    </view>
  </scroll-view>

  <!-- 添加按钮 -->
  <view class="fab-button" bindtap="onAddClick">
    <t-icon name="add" size="56rpx" color="#fff" />
  </view>

  <!-- 测试按钮（开发调试用） -->
  <view class="test-button" bindtap="testNotification" wx:if="{{showTestButton}}">
    <t-icon name="notification" size="32rpx" color="#1a5d6a" />
    <text class="test-text">测试推送</text>
  </view>

  <!-- 编辑/删除弹窗 -->
  <t-popup
    visible="{{showActionSheet}}"
    placement="bottom"
    bind:visible-change="onActionSheetChange"
  >
    <view class="action-sheet">
      <view class="action-header">
        <text class="action-title">{{currentItem.name}}</text>
        <text class="action-subtitle">{{currentItem.displayDate}}</text>
      </view>
      <view class="action-item" bindtap="onEditClick">
        <t-icon name="edit" size="40rpx" color="#1a5d6a" />
        <text>编辑</text>
      </view>
      <view class="action-item danger" bindtap="onDeleteClick">
        <t-icon name="delete" size="40rpx" color="#e34d59" />
        <text>删除</text>
      </view>
      <view class="action-item cancel" bindtap="onCancelAction">
        <text>取消</text>
      </view>
    </view>
  </t-popup>

  <!-- 删除确认对话框 -->
  <t-dialog
    visible="{{showDeleteDialog}}"
    title="确认删除"
    content="确定要删除这个纪念日吗？"
    confirm-btn="删除"
    cancel-btn="取消"
    bind:confirm="confirmDelete"
    bind:cancel="cancelDelete"
  />
</view>
